-- SmartStock Pro Enterprise - MariaDB Initialization Script
-- Use this script to set up your local or remote MariaDB instance.

-- 1. Create and Use the Database
CREATE DATABASE IF NOT EXISTS smartstock;
USE smartstock;

-- 2. System Settings & Identity (Stores One-Time System ID and License)
CREATE TABLE IF NOT EXISTS `settings` (
  `id` VARCHAR(50) PRIMARY KEY,
  `software_name` VARCHAR(255) DEFAULT 'SmartStock Pro',
  `primary_color` VARCHAR(50) DEFAULT 'indigo',
  `software_description` TEXT,
  `software_logo` VARCHAR(255) DEFAULT 'fa-warehouse',
  `license_key` TEXT,
  `license_expiry` DATE,
  `system_id` VARCHAR(100) -- This is generated once by the server
);

-- 3. Core User & Identity Management
CREATE TABLE IF NOT EXISTS `users` (
  `id` VARCHAR(50) PRIMARY KEY, 
  `username` VARCHAR(50) UNIQUE, 
  `password` VARCHAR(100), 
  `role` VARCHAR(20), 
  `full_name` VARCHAR(100),
  `department` VARCHAR(100),
  `shift_start_time` VARCHAR(10) DEFAULT '09:00',
  `team_lead_id` VARCHAR(50),
  `manager_id` VARCHAR(50),
  `joining_date` DATE,
  `designation` VARCHAR(100),
  `is_active` BOOLEAN DEFAULT TRUE
);

-- 4. Inventory & Asset Registry
CREATE TABLE IF NOT EXISTS `items` (
    `id` VARCHAR(50) PRIMARY KEY,
    `name` VARCHAR(255) NOT NULL,
    `category` VARCHAR(100),
    `serial` VARCHAR(100),
    `status` VARCHAR(50),
    `location` VARCHAR(255),
    `assignedTo` VARCHAR(255),
    `department` VARCHAR(100),
    `purchaseDate` DATE,
    `warranty` DATE,
    `cost` DECIMAL(15, 2),
    `qr_code` TEXT,
    `is_repairable` BOOLEAN DEFAULT TRUE
);

-- 5. Audit Trail & Asset Movements
CREATE TABLE IF NOT EXISTS `movements` (
    `id` VARCHAR(50) PRIMARY KEY,
    `date` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `item` VARCHAR(255),
    `from` VARCHAR(255),
    `to` VARCHAR(255),
    `employee` VARCHAR(255),
    `department` VARCHAR(100),
    `status` VARCHAR(50)
);

-- 6. HR & Attendance Tracking
CREATE TABLE IF NOT EXISTS `attendance` (
    `id` VARCHAR(100) PRIMARY KEY,
    `user_id` VARCHAR(50),
    `username` VARCHAR(100),
    `date` DATE,
    `check_in` DATETIME,
    `check_out` DATETIME,
    `status` VARCHAR(20),
    `location` VARCHAR(100)
);

CREATE TABLE IF NOT EXISTS `leave_requests` (
    `id` VARCHAR(50) PRIMARY KEY,
    `user_id` VARCHAR(50),
    `username` VARCHAR(100),
    `start_date` DATE,
    `end_date` DATE,
    `leave_type` VARCHAR(20),
    `reason` TEXT,
    `status` VARCHAR(20) DEFAULT 'PENDING'
);

-- 7. Procurement & Maintenance
CREATE TABLE IF NOT EXISTS `suppliers` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `name` VARCHAR(255) NOT NULL,
    `contact_person` VARCHAR(255),
    `email` VARCHAR(255),
    `rating` INT DEFAULT 0
);

CREATE TABLE IF NOT EXISTS `maintenance_logs` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `item_id` VARCHAR(50),
    `issue_type` VARCHAR(100),
    `description` TEXT,
    `status` VARCHAR(50),
    `cost` DECIMAL(15, 2),
    `start_date` DATE,
    `is_repairable` BOOLEAN DEFAULT TRUE
);

CREATE TABLE IF NOT EXISTS `licenses` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `software_name` VARCHAR(255) NOT NULL,
    `product_key` VARCHAR(255),
    `total_seats` INT,
    `assigned_seats` INT,
    `expiration_date` DATE,
    `supplier_id` INT
);

-- 8. Financial & Budgeting
CREATE TABLE IF NOT EXISTS `salaries` (
    `id` VARCHAR(50) PRIMARY KEY,
    `person_name` VARCHAR(255),
    `total_limit` DECIMAL(15, 2),
    `spent_amount` DECIMAL(15, 2),
    `category` VARCHAR(100),
    `notes` TEXT
);

-- 9. Organizational Structure
CREATE TABLE IF NOT EXISTS `departments` (
    `id` VARCHAR(50) PRIMARY KEY,
    `name` VARCHAR(100) NOT NULL,
    `manager` VARCHAR(255),
    `head` VARCHAR(255),
    `budget` DECIMAL(15, 2) DEFAULT 0,
    `budget_month` VARCHAR(20)
);

CREATE TABLE IF NOT EXISTS `roles` (
    `id` VARCHAR(50) PRIMARY KEY,
    `label` VARCHAR(100),
    `description` TEXT,
    `permissions` TEXT,
    `color` VARCHAR(50)
);

-- 10. Seed Initial Data
INSERT IGNORE INTO `users` (`id`, `username`, `password`, `role`, `full_name`, `is_active`) 
VALUES ('U-001', 'admin', 'admin', 'ADMIN', 'System Administrator', 1);

INSERT IGNORE INTO `roles` (`id`, `label`, `description`, `permissions`, `color`) VALUES 
('ADMIN', 'Administrator', 'Full system access', 'inventory.view,inventory.edit,hr.view,hr.salaries,hr.users,analytics.view,analytics.financials,analytics.logs,system.settings', 'indigo'),
('STAFF', 'Employee', 'Standard operational access', 'inventory.view,hr.view,analytics.view', 'slate');

INSERT IGNORE INTO `departments` (`id`, `name`, `manager`) VALUES 
('DEPT-IT', 'Information Technology', 'System Admin'),
('DEPT-HR', 'Human Resources', 'HR Manager');
